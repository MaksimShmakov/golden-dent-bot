# Golden Dent Telegram Bot

## Что делает бот

- Отправляет приветственное сообщение с тремя кнопками.
- При "Напомните через 2 недели" ставит повтор через 14 дней.
- При "Не готов записаться" собирает комментарий и пишет в Google Sheets.
- Ежедневно в 09:00 по Новосибирску:
  - отправляет напоминания о завтрашних записях,
  - отправляет 6‑месячные напоминания по дате последнего визита.
- Если сообщение не доставлено (Chat not found), пишет строку в лист "Не доставлено".

Важно: бот может писать пользователю только после того, как пользователь нажал **Start** у бота.

## Формат таблицы

Лист **"Записи для бота"**:
- A: `Date` (например `03.02.2026 18:00`)
- B: `tg_username` (например `@shmaaak`)

Как работает логика:
- Если дата в будущем и равна завтрашнему дню — отправляется сообщение о записи.
- Если дата в прошлом и ровно 6 месяцев назад от сегодня — отправляется 6‑месячное напоминание.

Лист **"Не готов записаться (комментарии)"**:
- A: дата и время
- B: tg_username
- C: комментарий

Лист **"Не доставлено"**:
- A: дата и время
- B: tg_username
- C: тип (`appointment` или `6m`)
- D: причина

## Локальный запуск

1. Скопируйте `.env.example` в `.env` и заполните значения.
2. Положите сервисный ключ Google в `service-account.json`.
3. Запустите:

```bash
docker compose up --build
```

## Вебхук и polling

- Если нет домена/https, используйте polling: `SET_WEBHOOK=false` (режим по умолчанию).
- Если есть публичный https домен, включите вебхук: `SET_WEBHOOK=true` и `WEBHOOK_URL`.
- В `WEBHOOK_SECRET_TOKEN` можно задать секрет для Telegram.
- Вебхук принимает запросы на `/webhook`.

## CI

В репозитории есть GitHub Actions workflow для ruff и pytest.